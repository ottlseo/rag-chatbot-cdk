"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.KnowledgeBase = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
const cdk = require("aws-cdk-lib");
const aws_cdk_lib_1 = require("aws-cdk-lib");
const iam = require("aws-cdk-lib/aws-iam");
const nag_suppressions_1 = require("cdk-nag/lib/nag-suppressions");
const constructs_1 = require("constructs");
const utils_1 = require("../../common/helpers/utils");
const amazonaurora_1 = require("../amazonaurora");
const opensearch_vectorindex_1 = require("../opensearch-vectorindex");
const opensearchserverless_1 = require("../opensearchserverless");
const pinecone_1 = require("../pinecone");
/**
 * Knowledge base can be backed by different vector databases.
 * This enum represents the different vector databases that can be used.
 *
 * `OPENSEARCH_SERVERLESS` is the default vector database.
 * `REDIS_ENTERPRISE_CLOUD` is the vector database for Redis Enterprise Cloud.
 * `PINECONE` is the vector database for Pinecone.
 * `AMAZON_AURORA` is the vector database for Amazon Aurora PostgreSQL.
 */
var VectorStoreType;
(function (VectorStoreType) {
    /**
     * `OPENSEARCH_SERVERLESS` is the vector store for OpenSearch Serverless.
     */
    VectorStoreType["OPENSEARCH_SERVERLESS"] = "OPENSEARCH_SERVERLESS";
    /**
     * `PINECONE` is the vector store for Pinecone.
     */
    VectorStoreType["PINECONE"] = "PINECONE";
    /**
     * `RDS` is the vector store for Amazon Aurora.
     */
    VectorStoreType["AMAZON_AURORA"] = "RDS";
})(VectorStoreType || (VectorStoreType = {}));
/**
 * Deploys a Bedrock Knowledge Base and configures a backend by OpenSearch Serverless,
 * Pinecone, Redis Enterprise Cloud or Amazon Aurora PostgreSQL.
 *
 */
class KnowledgeBase extends constructs_1.Construct {
    constructor(scope, id, props) {
        super(scope, id);
        this.instruction = props.instruction;
        const embeddingsModel = props.embeddingsModel;
        const indexName = props.indexName ?? 'bedrock-knowledge-base-default-index';
        const vectorField = props.vectorField ?? 'bedrock-knowledge-base-default-vector';
        const textField = 'AMAZON_BEDROCK_TEXT_CHUNK';
        const metadataField = 'AMAZON_BEDROCK_METADATA';
        this.description = props.description ?? 'CDK deployed Knowledge base'; // even though this prop is optional, if no value is provided it will fail to deploy
        this.knowledgeBaseState = props.knowledgeBaseState ?? 'ENABLED';
        validateModel(embeddingsModel);
        validateVectorIndex(props.vectorStore, props.vectorIndex, props.vectorField, props.indexName);
        if (props.vectorIndex) {
            validateIndexParameters(props.vectorIndex, indexName, vectorField);
        }
        this.name =
            props.name ?? (0, utils_1.generatePhysicalNameV2)(this, 'KB', { maxLength: 32 });
        if (props.existingRole) {
            this.role = props.existingRole;
        }
        else {
            const roleName = (0, utils_1.generatePhysicalNameV2)(this, 'AmazonBedrockExecutionRoleForKnowledgeBase', { maxLength: 64 });
            this.role = new iam.Role(this, 'Role', {
                roleName: roleName,
                assumedBy: new iam.ServicePrincipal('bedrock.amazonaws.com'),
            });
            this.role.assumeRolePolicy.addStatements(new iam.PolicyStatement({
                actions: ['sts:AssumeRole'],
                principals: [new iam.ServicePrincipal('bedrock.amazonaws.com')],
                conditions: {
                    StringEquals: {
                        'aws:SourceAccount': cdk.Stack.of(this).account,
                    },
                    ArnLike: {
                        'aws:SourceArn': cdk.Stack.of(this).formatArn({
                            service: 'bedrock',
                            resource: 'knowledge-base',
                            resourceName: '*',
                            arnFormat: cdk.ArnFormat.SLASH_RESOURCE_NAME,
                        }),
                    },
                },
            }));
            this.role.addToPolicy(new iam.PolicyStatement({
                actions: ['bedrock:InvokeModel'],
                resources: [embeddingsModel.asArn(this)],
            }));
        }
        /**
         * Create the vector store if the vector store was provided by the user.
         * Otherwise check againts all possible vector datastores.
         * If none was provided create default OpenSearch Serverless Collection.
         */
        if (props.vectorStore instanceof opensearchserverless_1.VectorCollection) {
            ({
                vectorStore: this.vectorStore,
                vectorStoreType: this.vectorStoreType,
            } = this.handleOpenSearchCollection(props));
        }
        else if (props.vectorStore instanceof pinecone_1.PineconeVectorStore) {
            ({
                vectorStore: this.vectorStore,
                vectorStoreType: this.vectorStoreType,
            } = this.handlePineconeVectorStore(props));
        }
        else if (props.vectorStore instanceof amazonaurora_1.AmazonAuroraVectorStore) {
            ({
                vectorStore: this.vectorStore,
                vectorStoreType: this.vectorStoreType,
            } = this.handleAmazonAuroraVectorStore(props));
        }
        else if (props.vectorStore instanceof amazonaurora_1.AmazonAuroraDefaultVectorStore) {
            ({
                vectorStore: this.vectorStore,
                vectorStoreType: this.vectorStoreType,
            } = this.handleAmazonAuroraDefaultVectorStore(props));
        }
        else {
            ({
                vectorStore: this.vectorStore,
                vectorStoreType: this.vectorStoreType,
            } = this.handleOpenSearchDefaultVectorCollection());
        }
        /**
         * We need to add `secretsmanager:GetSecretValue` to the role
         * of the knowledge base if we use data sources
         * other than OpenSearch Serverless.
         */
        if (!(this.vectorStore instanceof opensearchserverless_1.VectorCollection)) {
            this.role.addToPolicy(new iam.PolicyStatement({
                actions: ['secretsmanager:GetSecretValue'],
                resources: [this.vectorStore.credentialsSecretArn],
            }));
        }
        /**
         * We need to add `rds-data:ExecuteStatement`,
         * `rds-data:BatchExecuteStatement` and
         * `rds:DescribeDBClusters` to the role
         * of the knowledge base if we use Amazon Aurora as
         * a data source.
         */
        if (this.vectorStore instanceof amazonaurora_1.AmazonAuroraDefaultVectorStore ||
            this.vectorStore instanceof amazonaurora_1.AmazonAuroraVectorStore) {
            this.role.addToPolicy(new iam.PolicyStatement({
                actions: [
                    'rds-data:ExecuteStatement',
                    'rds-data:BatchExecuteStatement',
                    'rds:DescribeDBClusters',
                ],
                resources: [this.vectorStore.resourceArn],
            }));
        }
        /**
         * Create the vector index if the vector store is OpenSearch Serverless
         * and it was not provided. Otherwise use the provided vector index.
         */
        if (this.vectorStoreType === VectorStoreType.OPENSEARCH_SERVERLESS) {
            if (!props.vectorIndex) {
                this.vectorIndex = new opensearch_vectorindex_1.VectorIndex(this, 'KBIndex', {
                    collection: this.vectorStore,
                    indexName,
                    vectorField,
                    vectorDimensions: embeddingsModel.vectorDimensions,
                    mappings: [
                        {
                            mappingField: 'AMAZON_BEDROCK_TEXT_CHUNK',
                            dataType: 'text',
                            filterable: true,
                        },
                        {
                            mappingField: 'AMAZON_BEDROCK_METADATA',
                            dataType: 'text',
                            filterable: false,
                        },
                    ],
                });
                this.vectorIndex.node.addDependency(this.vectorStore);
            }
            else {
                this.vectorIndex = props.vectorIndex;
            }
        }
        /**
         * Create storage configuraion. If it is of type of
         * `AmazonAuroraVectorStore` get textField, metadataField,
         * vectorField from the arguments. Otherwise use default values.
         */
        const storageConfiguration = {
            indexName: indexName,
            vectorStore: this.vectorStore,
            vectorStoreType: this.vectorStoreType,
            vectorField: this.vectorStore instanceof amazonaurora_1.AmazonAuroraVectorStore
                ? this.vectorStore.vectorField
                : vectorField,
            textField: this.vectorStore instanceof amazonaurora_1.AmazonAuroraVectorStore ||
                this.vectorStore instanceof pinecone_1.PineconeVectorStore
                ? this.vectorStore.textField
                : textField,
            metadataField: this.vectorStore instanceof amazonaurora_1.AmazonAuroraVectorStore ||
                this.vectorStore instanceof pinecone_1.PineconeVectorStore
                ? this.vectorStore.metadataField
                : metadataField,
        };
        const knowledgeBase = new aws_cdk_lib_1.aws_bedrock.CfnKnowledgeBase(this, 'MyCfnKnowledgeBase', {
            knowledgeBaseConfiguration: {
                type: 'VECTOR',
                vectorKnowledgeBaseConfiguration: {
                    embeddingModelArn: embeddingsModel.asArn(this),
                },
            },
            name: this.name,
            roleArn: this.role.roleArn,
            storageConfiguration: getStorageConfiguration(storageConfiguration),
            description: props.description,
            tags: props.tags,
        });
        this.knowledgeBaseInstance = knowledgeBase;
        const kbCRPolicy = new iam.Policy(this, 'KBCRPolicy', {
            // roles: [crProvider.role],
            roles: [this.role],
            statements: [
                new iam.PolicyStatement({
                    actions: [
                        'bedrock:CreateKnowledgeBase',
                        /**
                         * We need to add `bedrock:AssociateThirdPartyKnowledgeBase` if
                         * we are deploying Redis or Pinecone data sources
                         */
                        //...(this.vectorStoreType === VectorStoreType.REDIS_ENTERPRISE_CLOUD ||
                        ...(this.vectorStoreType === VectorStoreType.PINECONE
                            ? ['bedrock:AssociateThirdPartyKnowledgeBase']
                            : []),
                    ],
                    resources: ['*'],
                }),
                new iam.PolicyStatement({
                    actions: [
                        'bedrock:UpdateKnowledgeBase',
                        'bedrock:DeleteKnowledgeBase',
                        'bedrock:TagResource',
                    ],
                    resources: [
                        cdk.Stack.of(this).formatArn({
                            service: 'bedrock',
                            resource: 'knowledge-base',
                            resourceName: '*',
                            arnFormat: cdk.ArnFormat.SLASH_RESOURCE_NAME,
                        }),
                    ],
                }),
                new iam.PolicyStatement({
                    actions: ['iam:PassRole'],
                    resources: [this.role.roleArn],
                }),
            ],
        });
        knowledgeBase.node.addDependency(this.role);
        knowledgeBase.node.addDependency(kbCRPolicy);
        if (this.vectorStoreType === VectorStoreType.OPENSEARCH_SERVERLESS &&
            this.vectorIndex) {
            knowledgeBase.node.addDependency(this.vectorIndex);
        }
        if (this.vectorStoreType === VectorStoreType.AMAZON_AURORA &&
            this.vectorStore instanceof amazonaurora_1.AmazonAuroraDefaultVectorStore) {
            knowledgeBase.node.addDependency(this.vectorStore);
        }
        nag_suppressions_1.NagSuppressions.addResourceSuppressions(kbCRPolicy, [
            {
                id: 'AwsSolutions-IAM5',
                reason: "Bedrock CreateKnowledgeBase can't be restricted by resource.",
            },
        ], true);
        this.knowledgeBaseArn = knowledgeBase.attrKnowledgeBaseArn;
        this.knowledgeBaseId = knowledgeBase.attrKnowledgeBaseId;
    }
    /**
     * Handle VectorCollection type of VectorStore.
     *
     * @param props - The properties of the KnowledgeBase.
     * @returns The instance of VectorCollection, VectorStoreType.
     * @internal This is an internal core function and should not be called directly.
     */
    handleOpenSearchCollection(props) {
        const vectorStore = props.vectorStore;
        vectorStore.grantDataAccess(this.role);
        return {
            vectorStore: vectorStore,
            vectorStoreType: VectorStoreType.OPENSEARCH_SERVERLESS,
        };
    }
    /**
     * Handle PineconeVectorStore type of VectorStore.
     *
     * @param props - The properties of the KnowledgeBase.
     * @returns The instance of PineconeVectorStore, VectorStoreType.
     * @internal This is an internal core function and should not be called directly.
     */
    handlePineconeVectorStore(props) {
        const vectorStore = props.vectorStore;
        return {
            vectorStore: vectorStore,
            vectorStoreType: VectorStoreType.PINECONE,
        };
    }
    /**
     * Handle AmazonAuroraVectorStore type of VectorStore.
     *
     * @param props - The properties of the KnowledgeBase.
     * @returns The instance of AmazonAuroraVectorStore, VectorStoreType.
     * @internal This is an internal core function and should not be called directly.
     */
    handleAmazonAuroraVectorStore(props) {
        const vectorStore = props.vectorStore;
        return {
            vectorStore: vectorStore,
            vectorStoreType: VectorStoreType.AMAZON_AURORA,
        };
    }
    /**
     * Handle AmazonAuroraDefaultVectorStore type of VectorStore.
     *
     * @param props - The properties of the KnowledgeBase.
     * @returns The instance of AmazonAuroraDefaultVectorStore, VectorStoreType.
     * @internal This is an internal core function and should not be called directly.
     */
    handleAmazonAuroraDefaultVectorStore(props) {
        const vectorStore = props.vectorStore;
        return {
            vectorStore: vectorStore,
            vectorStoreType: VectorStoreType.AMAZON_AURORA,
        };
    }
    /**
     * Handle the default VectorStore type.
     *
     * @returns The instance of VectorCollection, VectorStoreType.
     * @internal This is an internal core function and should not be called directly.
     */
    handleOpenSearchDefaultVectorCollection() {
        const vectorStore = new opensearchserverless_1.VectorCollection(this, 'KBVectors');
        vectorStore.grantDataAccess(this.role);
        return {
            vectorStore: vectorStore,
            vectorStoreType: VectorStoreType.OPENSEARCH_SERVERLESS,
        };
    }
    /**
     * Associate knowledge base with an agent
     */
    associateToAgent(agent) {
        const agentKnowledgeBaseProperty = {
            description: this.description,
            knowledgeBaseId: this.knowledgeBaseId,
            knowledgeBaseState: this.knowledgeBaseState,
        };
        agent.knowledgeBases = [agentKnowledgeBaseProperty];
    }
}
exports.KnowledgeBase = KnowledgeBase;
_a = JSII_RTTI_SYMBOL_1;
KnowledgeBase[_a] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.KnowledgeBase", version: "0.1.216" };
/**
 * Validate that Bedrock Knowledge Base can use the selected model.
 *
 * @internal This is an internal core function and should not be called directly.
 */
function validateModel(foundationModel) {
    if (!foundationModel.supportsKnowledgeBase) {
        throw new Error(`The model ${foundationModel} is not supported by Bedrock Knowledge Base.`);
    }
}
/**
 * Validate if VectorIndex was provided for a VectorStore of type
 * other than `VectorCollection`.
 *
 * @internal This is an internal core function and should not be called directly.
 */
function validateVectorIndex(vectorStore, vectorIndex, vectorField, indexName) {
    if (!(vectorStore instanceof opensearchserverless_1.VectorCollection) && vectorIndex) {
        throw new Error('If vectorStore is not of type VectorCollection, vectorIndex should not be provided ' +
            'in KnowledgeBase construct.');
    }
    if (!(vectorStore instanceof opensearchserverless_1.VectorCollection) && indexName) {
        throw new Error('If vectorStore is not of type VectorCollection, indexName should not be provided ' +
            'in KnowledgeBase construct.');
    }
    if (!(vectorStore instanceof opensearchserverless_1.VectorCollection) && vectorField) {
        throw new Error('If vectorStore is not of type VectorCollection, vectorField should not be provided ' +
            'in KnowledgeBase construct.');
    }
}
/**
 * Validate that indexName and vectorField parameters are identical
 * in KnowledgeBase construct if VectorIndex was created manually.
 *
 * By default we assign `vectorIndex` to `bedrock-knowledge-base-default-index`
 * value and if user provides `vectorIndex` manually, we need to make sure
 * they also provide it in KnowledgeBase construct if the value is not
 * `bedrock-knowledge-base-default-index`. Same for vectorField.
 *
 * @internal This is an internal core function and should not be called directly.
 */
function validateIndexParameters(vectorIndex, indexName, vectorField) {
    if (vectorIndex.indexName !== 'bedrock-knowledge-base-default-index') {
        if (vectorIndex.indexName !== indexName) {
            throw new Error('Default value of indexName is `bedrock-knowledge-base-default-index`.' +
                ' If you create VectorIndex manually and assign vectorIndex to value other than' +
                ' `bedrock-knowledge-base-default-index` then you must provide the same value in KnowledgeBase construct.' +
                ' If you created VectorIndex manually and set it to `bedrock-knowledge-base-default-index`' +
                ' then do not assign indexName in KnowledgeBase construct.');
        }
    }
    if (vectorIndex.vectorField !== 'bedrock-knowledge-base-default-vector') {
        if (vectorIndex.vectorField !== vectorField) {
            throw new Error('Default value of vectorField is `bedrock-knowledge-base-default-vector`.' +
                ' If you create VectorIndex manually and assign vectorField to value other than' +
                ' `bedrock-knowledge-base-default-field` then you must provide the same value in KnowledgeBase construct.' +
                ' If you created VectorIndex manually and set it to `bedrock-knowledge-base-default-vector`' +
                ' then do not assign vectorField in KnowledgeBase construct.');
        }
    }
}
/**
 * Determine storage configuration based on vector store type.
 *
 * @internal This is an internal core function and should not be called directly.
 */
function getStorageConfiguration(params) {
    switch (params.vectorStoreType) {
        case VectorStoreType.OPENSEARCH_SERVERLESS:
            params.vectorStore = params.vectorStore;
            return {
                type: VectorStoreType.OPENSEARCH_SERVERLESS,
                opensearchServerlessConfiguration: {
                    collectionArn: params.vectorStore.collectionArn,
                    fieldMapping: {
                        vectorField: params.vectorField,
                        textField: params.textField,
                        metadataField: params.metadataField,
                    },
                    vectorIndexName: params.indexName,
                },
            };
        case VectorStoreType.PINECONE:
            params.vectorStore = params.vectorStore;
            return {
                type: VectorStoreType.PINECONE,
                pineconeConfiguration: {
                    namespace: params.vectorStore.namespace || undefined,
                    connectionString: params.vectorStore.connectionString,
                    credentialsSecretArn: params.vectorStore.credentialsSecretArn,
                    fieldMapping: {
                        textField: params.textField,
                        metadataField: params.metadataField,
                    },
                },
            };
        case VectorStoreType.AMAZON_AURORA:
            params.vectorStore =
                params.vectorStore instanceof amazonaurora_1.AmazonAuroraVectorStore
                    ? params.vectorStore
                    : params.vectorStore;
            return {
                type: VectorStoreType.AMAZON_AURORA,
                rdsConfiguration: {
                    credentialsSecretArn: params.vectorStore.credentialsSecretArn,
                    databaseName: params.vectorStore.databaseName,
                    resourceArn: params.vectorStore.resourceArn,
                    tableName: params.vectorStore.tableName,
                    fieldMapping: {
                        vectorField: params.vectorField.replace(/-/g, '_'),
                        primaryKeyField: params.vectorStore.primaryKeyField,
                        textField: params.textField.toLowerCase(),
                        metadataField: params.metadataField.toLowerCase(),
                    },
                },
            };
        default:
            throw new Error(`Unsupported vector store type: ${params.vectorStoreType}`);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoia25vd2xlZGdlLWJhc2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY2RrLWxpYi9iZWRyb2NrL2tub3dsZWRnZS1iYXNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7Ozs7Ozs7Ozs7O0dBV0c7QUFFSCxtQ0FBbUM7QUFDbkMsNkNBQXFEO0FBQ3JELDJDQUEyQztBQUMzQyxtRUFBK0Q7QUFDL0QsMkNBQXVDO0FBR3ZDLHNEQUFvRTtBQUNwRSxrREFHeUI7QUFFekIsc0VBQXdEO0FBQ3hELGtFQUEyRDtBQUMzRCwwQ0FBa0Q7QUFFbEQ7Ozs7Ozs7O0dBUUc7QUFDSCxJQUFLLGVBYUo7QUFiRCxXQUFLLGVBQWU7SUFDbEI7O09BRUc7SUFDSCxrRUFBK0MsQ0FBQTtJQUMvQzs7T0FFRztJQUNILHdDQUFxQixDQUFBO0lBQ3JCOztPQUVHO0lBQ0gsd0NBQXFCLENBQUE7QUFDdkIsQ0FBQyxFQWJJLGVBQWUsS0FBZixlQUFlLFFBYW5CO0FBMElEOzs7O0dBSUc7QUFDSCxNQUFhLGFBQWMsU0FBUSxzQkFBUztJQTZEMUMsWUFBWSxLQUFnQixFQUFFLEVBQVUsRUFBRSxLQUF5QjtRQUNqRSxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ2pCLElBQUksQ0FBQyxXQUFXLEdBQUcsS0FBSyxDQUFDLFdBQVcsQ0FBQztRQUNyQyxNQUFNLGVBQWUsR0FBRyxLQUFLLENBQUMsZUFBZSxDQUFDO1FBQzlDLE1BQU0sU0FBUyxHQUFHLEtBQUssQ0FBQyxTQUFTLElBQUksc0NBQXNDLENBQUM7UUFDNUUsTUFBTSxXQUFXLEdBQ2YsS0FBSyxDQUFDLFdBQVcsSUFBSSx1Q0FBdUMsQ0FBQztRQUMvRCxNQUFNLFNBQVMsR0FBRywyQkFBMkIsQ0FBQztRQUM5QyxNQUFNLGFBQWEsR0FBRyx5QkFBeUIsQ0FBQztRQUVoRCxJQUFJLENBQUMsV0FBVyxHQUFHLEtBQUssQ0FBQyxXQUFXLElBQUksNkJBQTZCLENB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IG9yIGl0cyBhZmZpbGlhdGVzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqICBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpLiBZb3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiAgd2l0aCB0aGUgTGljZW5zZS4gQSBjb3B5IG9mIHRoZSBMaWNlbnNlIGlzIGxvY2F0ZWQgYXRcbiAqXG4gKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqICBvciBpbiB0aGUgJ2xpY2Vuc2UnIGZpbGUgYWNjb21wYW55aW5nIHRoaXMgZmlsZS4gVGhpcyBmaWxlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICdBUyBJUycgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFU1xuICogIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGV4cHJlc3Mgb3IgaW1wbGllZC4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zXG4gKiAgYW5kIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCAqIGFzIGNkayBmcm9tICdhd3MtY2RrLWxpYic7XG5pbXBvcnQgeyBhd3NfYmVkcm9jayBhcyBiZWRyb2NrIH0gZnJvbSAnYXdzLWNkay1saWInO1xuaW1wb3J0ICogYXMgaWFtIGZyb20gJ2F3cy1jZGstbGliL2F3cy1pYW0nO1xuaW1wb3J0IHsgTmFnU3VwcHJlc3Npb25zIH0gZnJvbSAnY2RrLW5hZy9saWIvbmFnLXN1cHByZXNzaW9ucyc7XG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tICdjb25zdHJ1Y3RzJztcbmltcG9ydCB7IEFnZW50IH0gZnJvbSAnLi8uLi9iZWRyb2NrL2FnZW50JztcbmltcG9ydCB7IEJlZHJvY2tGb3VuZGF0aW9uTW9kZWwgfSBmcm9tICcuL21vZGVscyc7XG5pbXBvcnQgeyBnZW5lcmF0ZVBoeXNpY2FsTmFtZVYyIH0gZnJvbSAnLi4vLi4vY29tbW9uL2hlbHBlcnMvdXRpbHMnO1xuaW1wb3J0IHtcbiAgQW1hem9uQXVyb3JhRGVmYXVsdFZlY3RvclN0b3JlLFxuICBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZSxcbn0gZnJvbSAnLi4vYW1hem9uYXVyb3JhJztcblxuaW1wb3J0IHsgVmVjdG9ySW5kZXggfSBmcm9tICcuLi9vcGVuc2VhcmNoLXZlY3RvcmluZGV4JztcbmltcG9ydCB7IFZlY3RvckNvbGxlY3Rpb24gfSBmcm9tICcuLi9vcGVuc2VhcmNoc2VydmVybGVzcyc7XG5pbXBvcnQgeyBQaW5lY29uZVZlY3RvclN0b3JlIH0gZnJvbSAnLi4vcGluZWNvbmUnO1xuXG4vKipcbiAqIEtub3dsZWRnZSBiYXNlIGNhbiBiZSBiYWNrZWQgYnkgZGlmZmVyZW50IHZlY3RvciBkYXRhYmFzZXMuXG4gKiBUaGlzIGVudW0gcmVwcmVzZW50cyB0aGUgZGlmZmVyZW50IHZlY3RvciBkYXRhYmFzZXMgdGhhdCBjYW4gYmUgdXNlZC5cbiAqXG4gKiBgT1BFTlNFQVJDSF9TRVJWRVJMRVNTYCBpcyB0aGUgZGVmYXVsdCB2ZWN0b3IgZGF0YWJhc2UuXG4gKiBgUkVESVNfRU5URVJQUklTRV9DTE9VRGAgaXMgdGhlIHZlY3RvciBkYXRhYmFzZSBmb3IgUmVkaXMgRW50ZXJwcmlzZSBDbG91ZC5cbiAqIGBQSU5FQ09ORWAgaXMgdGhlIHZlY3RvciBkYXRhYmFzZSBmb3IgUGluZWNvbmUuXG4gKiBgQU1BWk9OX0FVUk9SQWAgaXMgdGhlIHZlY3RvciBkYXRhYmFzZSBmb3IgQW1hem9uIEF1cm9yYSBQb3N0Z3JlU1FMLlxuICovXG5lbnVtIFZlY3RvclN0b3JlVHlwZSB7XG4gIC8qKlxuICAgKiBgT1BFTlNFQVJDSF9TRVJWRVJMRVNTYCBpcyB0aGUgdmVjdG9yIHN0b3JlIGZvciBPcGVuU2VhcmNoIFNlcnZlcmxlc3MuXG4gICAqL1xuICBPUEVOU0VBUkNIX1NFUlZFUkxFU1MgPSAnT1BFTlNFQVJDSF9TRVJWRVJMRVNTJyxcbiAgLyoqXG4gICAqIGBQSU5FQ09ORWAgaXMgdGhlIHZlY3RvciBzdG9yZSBmb3IgUGluZWNvbmUuXG4gICAqL1xuICBQSU5FQ09ORSA9ICdQSU5FQ09ORScsXG4gIC8qKlxuICAgKiBgUkRTYCBpcyB0aGUgdmVjdG9yIHN0b3JlIGZvciBBbWF6b24gQXVyb3JhLlxuICAgKi9cbiAgQU1BWk9OX0FVUk9SQSA9ICdSRFMnLFxufVxuXG4vKipcbiAqIEludGVyZmFjZSBmb3IgdGhlIGNvbmZpZ3VyYXRpb24gb2YgdGhlIHN0b3JhZ2UgZm9yIGtub3dsZWRnZSBiYXNlLlxuICovXG5pbnRlcmZhY2UgU3RvcmFnZUNvbmZpZ3VyYXRpb24ge1xuICAvKipcbiAgICogVGhlIHZlY3RvciBzdG9yZSwgd2hpY2ggY2FuIGJlIG9mIGBWZWN0b3JDb2xsZWN0aW9uYCwgYFBpbmVjb25lVmVjdG9yU3RvcmVgLFxuICAgKiBgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmVgIG9yIGBBbWF6b25BdXJvcmFEZWZhdWx0VmVjdG9yU3RvcmVgXG4gICAqIHR5cGVzLlxuICAgKi9cbiAgdmVjdG9yU3RvcmU6XG4gIHwgVmVjdG9yQ29sbGVjdGlvblxuICB8IFBpbmVjb25lVmVjdG9yU3RvcmVcbiAgfCBBbWF6b25BdXJvcmFEZWZhdWx0VmVjdG9yU3RvcmVcbiAgfCBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZTtcblxuICAvKipcbiAgICogVGhlIHR5cGUgb2YgdGhlIHZlY3RvciBzdG9yZS5cbiAgICovXG4gIHZlY3RvclN0b3JlVHlwZTogVmVjdG9yU3RvcmVUeXBlO1xuXG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgaW5kZXguXG4gICAqL1xuICBpbmRleE5hbWU6IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIGZpZWxkIG9mIHRoZSB2ZWN0b3IgZmllbGQgZm9yIHZlY3RvciBtYXBwaW5nLlxuICAgKi9cbiAgdmVjdG9yRmllbGQ6IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIGZpZWxkIG9mIHRoZSB0ZXh0IGZpZWxkIGZvciB2ZWN0b3IgbWFwcGluZy5cbiAgICovXG4gIHRleHRGaWVsZDogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgZmllbGQgb2YgdGhlIG1ldGFkYXRhLlxuICAgKi9cbiAgbWV0YWRhdGFGaWVsZDogc3RyaW5nO1xufVxuXG4vKipcbiAqIFByb3BlcnRpZXMgZm9yIGEga25vd2xlZGdlIGJhc2VcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBLbm93bGVkZ2VCYXNlUHJvcHMge1xuICAvKipcbiAgICogVGhlIGVtYmVkZGluZ3MgbW9kZWwgZm9yIHRoZSBrbm93bGVkZ2UgYmFzZVxuICAgKi9cbiAgcmVhZG9ubHkgZW1iZWRkaW5nc01vZGVsOiBCZWRyb2NrRm91bmRhdGlvbk1vZGVsO1xuXG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUga25vd2xlZGdlIGJhc2UuXG4gICAqL1xuICByZWFkb25seSBuYW1lPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgZGVzY3JpcHRpb24gb2YgdGhlIGtub3dsZWRnZSBiYXNlLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIE5vIGRlc2NyaXB0aW9uIHByb3ZpZGVkLlxuICAgKi9cbiAgcmVhZG9ubHkgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEV4aXN0aW5nIElBTSByb2xlIHdpdGggYSBwb2xpY3kgc3RhdGVtZW50XG4gICAqIGdyYW50aW5nIHBlcm1pc3Npb24gdG8gaW52b2tlIHRoZSBzcGVjaWZpYyBlbWJlZGRpbmdzIG1vZGVsLlxuICAgKiBBbnkgZW50aXR5IChlLmcuLCBhbiBBV1Mgc2VydmljZSBvciBhcHBsaWNhdGlvbikgdGhhdCBhc3N1bWVzXG4gICAqIHRoaXMgcm9sZSB3aWxsIGJlIGFibGUgdG8gaW52b2tlIG9yIHVzZSB0aGVcbiAgICogc3BlY2lmaWVkIGVtYmVkZGluZ3MgbW9kZWwgd2l0aGluIHRoZSBCZWRyb2NrIHNlcnZpY2UuXG4gICAqL1xuICByZWFkb25seSBleGlzdGluZ1JvbGU/OiBpYW0uUm9sZTtcblxuICAvKipcbiAgICogQSBuYXJyYXRpdmUgZGVzY3JpcHRpb24gb2YgdGhlIGtub3dsZWRnZSBiYXNlLlxuICAgKlxuICAgKiBBIEJlZHJvY2sgQWdlbnQgY2FuIHVzZSB0aGlzIGluc3RydWN0aW9uIHRvIGRldGVybWluZSBpZiBpdCBzaG91bGRcbiAgICogcXVlcnkgdGhpcyBLbm93bGVkZ2UgQmFzZS5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBObyBkZXNjcmlwdGlvbiBwcm92aWRlZC5cbiAgICovXG4gIHJlYWRvbmx5IGluc3RydWN0aW9uPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgdmVjdG9yIGluZGV4LlxuICAgKiBJZiB2ZWN0b3JTdG9yZSBpcyBub3Qgb2YgdHlwZSBgVmVjdG9yQ29sbGVjdGlvbmAsXG4gICAqIGRvIG5vdCBpbmNsdWRlIHRoaXMgcHJvcGVydHkgYXMgaXQgd2lsbCB0aHJvdyBlcnJvci5cbiAgICpcbiAgICogQGRlZmF1bHQgLSAnYmVkcm9jay1rbm93bGVkZ2UtYmFzZS1kZWZhdWx0LWluZGV4J1xuICAgKi9cbiAgcmVhZG9ubHkgaW5kZXhOYW1lPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgZmllbGQgaW4gdGhlIHZlY3RvciBpbmRleC5cbiAgICogSWYgdmVjdG9yU3RvcmUgaXMgbm90IG9mIHR5cGUgYFZlY3RvckNvbGxlY3Rpb25gLFxuICAgKiBkbyBub3QgaW5jbHVkZSB0aGlzIHByb3BlcnR5IGFzIGl0IHdpbGwgdGhyb3cgZXJyb3IuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gJ2JlZHJvY2sta25vd2xlZGdlLWJhc2UtZGVmYXVsdC12ZWN0b3InXG4gICAqL1xuICByZWFkb25seSB2ZWN0b3JGaWVsZD86IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIHZlY3RvciBzdG9yZSBmb3IgdGhlIGtub3dsZWRnZSBiYXNlLiBNdXN0IGJlIGVpdGhlciBvZlxuICAgKiB0eXBlIGBWZWN0b3JDb2xsZWN0aW9uYCwgYFJlZGlzRW50ZXJwcmlzZVZlY3RvclN0b3JlYCxcbiAgICogYFBpbmVjb25lVmVjdG9yU3RvcmVgLCBgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmVgIG9yXG4gICAqIGBBbWF6b25BdXJvcmFEZWZhdWx0VmVjdG9yU3RvcmVgLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIEEgbmV3IE9wZW5TZWFyY2ggU2VydmVybGVzcyB2ZWN0b3IgY29sbGVjdGlvbiBpcyBjcmVhdGVkLlxuICAgKi9cbiAgcmVhZG9ubHkgdmVjdG9yU3RvcmU/OlxuICB8IFZlY3RvckNvbGxlY3Rpb25cbiAgfCBQaW5lY29uZVZlY3RvclN0b3JlXG4gIHwgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmVcbiAgfCBBbWF6b25BdXJvcmFEZWZhdWx0VmVjdG9yU3RvcmU7XG5cbiAgLyoqXG4gICAqIFRoZSB2ZWN0b3IgaW5kZXggZm9yIHRoZSBPcGVuU2VhcmNoIFNlcnZlcmxlc3MgYmFja2VkIGtub3dsZWRnZSBiYXNlLlxuICAgKiBJZiB2ZWN0b3JTdG9yZSBpcyBub3Qgb2YgdHlwZSBgVmVjdG9yQ29sbGVjdGlvbmAsIGRvIG5vdCBpbmNsdWRlXG4gICAqIHRoaXMgcHJvcGVydHkgYXMgaXQgd2lsbCB0aHJvdyBlcnJvci5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBBIG5ldyB2ZWN0b3IgaW5kZXggaXMgY3JlYXRlZCBvbiB0aGUgVmVjdG9yIENvbGxlY3Rpb25cbiAgICogaWYgdmVjdG9yIHN0b3JlIGlzIG9mIGBWZWN0b3JDb2xsZWN0aW9uYCB0eXBlLlxuICAgKi9cbiAgcmVhZG9ubHkgdmVjdG9ySW5kZXg/OiBWZWN0b3JJbmRleDtcblxuICAvKipcbiAgICogU3BlY2lmaWVzIHdoZXRoZXIgdG8gdXNlIHRoZSBrbm93bGVkZ2UgYmFzZSBvciBub3Qgd2hlbiBzZW5kaW5nIGFuIEludm9rZUFnZW50IHJlcXVlc3QuXG4gICAqL1xuICByZWFkb25seSBrbm93bGVkZ2VCYXNlU3RhdGU/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIE9QVElPTkFMOiBUYWcgKEtFWS1WQUxVRSkgYmVkcm9jayBhZ2VudCByZXNvdXJjZVxuICAgKlxuICAgKiBAZGVmYXVsdCAtIGZhbHNlXG4gICAqL1xuICByZWFkb25seSB0YWdzPzogUmVjb3JkPHN0cmluZywgc3RyaW5nPjtcbn1cblxuLyoqXG4gKiBEZXBsb3lzIGEgQmVkcm9jayBLbm93bGVkZ2UgQmFzZSBhbmQgY29uZmlndXJlcyBhIGJhY2tlbmQgYnkgT3BlblNlYXJjaCBTZXJ2ZXJsZXNzLFxuICogUGluZWNvbmUsIFJlZGlzIEVudGVycHJpc2UgQ2xvdWQgb3IgQW1hem9uIEF1cm9yYSBQb3N0Z3JlU1FMLlxuICpcbiAqL1xuZXhwb3J0IGNsYXNzIEtub3dsZWRnZUJhc2UgZXh0ZW5kcyBDb25zdHJ1Y3Qge1xuICAvKipcbiAgICogVGhlIG5hbWUgb2YgdGhlIGtub3dsZWRnZSBiYXNlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IG5hbWU6IHN0cmluZztcblxuICAvKipcbiAgICogSW5zdGFuY2Ugb2Yga25vd2xlZGdlIGJhc2UuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkga25vd2xlZGdlQmFzZUluc3RhbmNlOiBiZWRyb2NrLkNmbktub3dsZWRnZUJhc2U7XG5cbiAgLyoqXG4gICAqIFRoZSByb2xlIHRoZSBLbm93bGVkZ2UgQmFzZSB1c2VzIHRvIGFjY2VzcyB0aGUgdmVjdG9yIHN0b3JlIGFuZCBkYXRhIHNvdXJjZS5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSByb2xlOiBpYW0uUm9sZTtcblxuICAvKipcbiAgICogVGhlIHZlY3RvciBzdG9yZSBmb3IgdGhlIGtub3dsZWRnZSBiYXNlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IHZlY3RvclN0b3JlOlxuICB8IFZlY3RvckNvbGxlY3Rpb25cbiAgfCBQaW5lY29uZVZlY3RvclN0b3JlXG4gIHwgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmVcbiAgfCBBbWF6b25BdXJvcmFEZWZhdWx0VmVjdG9yU3RvcmU7XG5cbiAgLyoqXG4gICAqIEEgbmFycmF0aXZlIGluc3RydWN0aW9uIG9mIHRoZSBrbm93bGVkZ2UgYmFzZS5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBpbnN0cnVjdGlvbj86IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIEFSTiBvZiB0aGUga25vd2xlZGdlIGJhc2UuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkga25vd2xlZGdlQmFzZUFybjogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgSUQgb2YgdGhlIGtub3dsZWRnZSBiYXNlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGtub3dsZWRnZUJhc2VJZDogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIE9wZW5TZWFyY2ggdmVjdG9yIGluZGV4IGZvciB0aGUga25vd2xlZGdlIGJhc2UuXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBwcml2YXRlIHZlY3RvckluZGV4PzogVmVjdG9ySW5kZXg7XG5cbiAgLyoqXG4gICAqIFRoZSBkZXNjcmlwdGlvbiBrbm93bGVkZ2UgYmFzZS5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBkZXNjcmlwdGlvbjogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBTcGVjaWZpZXMgd2hldGhlciB0byB1c2UgdGhlIGtub3dsZWRnZSBiYXNlIG9yIG5vdCB3aGVuIHNlbmRpbmcgYW4gSW52b2tlQWdlbnQgcmVxdWVzdC5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBrbm93bGVkZ2VCYXNlU3RhdGU6IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIHR5cGUgb2YgdGhlIGtub3dsZWRnZSBiYXNlLlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgcHJpdmF0ZSB2ZWN0b3JTdG9yZVR5cGU6IFZlY3RvclN0b3JlVHlwZTtcblxuICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBwcm9wczogS25vd2xlZGdlQmFzZVByb3BzKSB7XG4gICAgc3VwZXIoc2NvcGUsIGlkKTtcbiAgICB0aGlzLmluc3RydWN0aW9uID0gcHJvcHMuaW5zdHJ1Y3Rpb247XG4gICAgY29uc3QgZW1iZWRkaW5nc01vZGVsID0gcHJvcHMuZW1iZWRkaW5nc01vZGVsO1xuICAgIGNvbnN0IGluZGV4TmFtZSA9IHByb3BzLmluZGV4TmFtZSA/PyAnYmVkcm9jay1rbm93bGVkZ2UtYmFzZS1kZWZhdWx0LWluZGV4JztcbiAgICBjb25zdCB2ZWN0b3JGaWVsZCA9XG4gICAgICBwcm9wcy52ZWN0b3JGaWVsZCA/PyAnYmVkcm9jay1rbm93bGVkZ2UtYmFzZS1kZWZhdWx0LXZlY3Rvcic7XG4gICAgY29uc3QgdGV4dEZpZWxkID0gJ0FNQVpPTl9CRURST0NLX1RFWFRfQ0hVTksnO1xuICAgIGNvbnN0IG1ldGFkYXRhRmllbGQgPSAnQU1BWk9OX0JFRFJPQ0tfTUVUQURBVEEnO1xuXG4gICAgdGhpcy5kZXNjcmlwdGlvbiA9IHByb3BzLmRlc2NyaXB0aW9uID8/ICdDREsgZGVwbG95ZWQgS25vd2xlZGdlIGJhc2UnOyAvLyBldmVuIHRob3VnaCB0aGlzIHByb3AgaXMgb3B0aW9uYWwsIGlmIG5vIHZhbHVlIGlzIHByb3ZpZGVkIGl0IHdpbGwgZmFpbCB0byBkZXBsb3lcbiAgICB0aGlzLmtub3dsZWRnZUJhc2VTdGF0ZSA9IHByb3BzLmtub3dsZWRnZUJhc2VTdGF0ZSA/PyAnRU5BQkxFRCc7XG5cbiAgICB2YWxpZGF0ZU1vZGVsKGVtYmVkZGluZ3NNb2RlbCk7XG4gICAgdmFsaWRhdGVWZWN0b3JJbmRleChcbiAgICAgIHByb3BzLnZlY3RvclN0b3JlLFxuICAgICAgcHJvcHMudmVjdG9ySW5kZXgsXG4gICAgICBwcm9wcy52ZWN0b3JGaWVsZCxcbiAgICAgIHByb3BzLmluZGV4TmFtZSxcbiAgICApO1xuICAgIGlmIChwcm9wcy52ZWN0b3JJbmRleCkge1xuICAgICAgdmFsaWRhdGVJbmRleFBhcmFtZXRlcnMocHJvcHMudmVjdG9ySW5kZXgsIGluZGV4TmFtZSwgdmVjdG9yRmllbGQpO1xuICAgIH1cblxuICAgIHRoaXMubmFtZSA9XG4gICAgICBwcm9wcy5uYW1lID8/IGdlbmVyYXRlUGh5c2ljYWxOYW1lVjIodGhpcywgJ0tCJywgeyBtYXhMZW5ndGg6IDMyIH0pO1xuXG4gICAgaWYgKHByb3BzLmV4aXN0aW5nUm9sZSkge1xuICAgICAgdGhpcy5yb2xlID0gcHJvcHMuZXhpc3RpbmdSb2xlO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCByb2xlTmFtZSA9IGdlbmVyYXRlUGh5c2ljYWxOYW1lVjIoXG4gICAgICAgIHRoaXMsXG4gICAgICAgICdBbWF6b25CZWRyb2NrRXhlY3V0aW9uUm9sZUZvcktub3dsZWRnZUJhc2UnLFxuICAgICAgICB7IG1heExlbmd0aDogNjQgfSxcbiAgICAgICk7XG4gICAgICB0aGlzLnJvbGUgPSBuZXcgaWFtLlJvbGUodGhpcywgJ1JvbGUnLCB7XG4gICAgICAgIHJvbGVOYW1lOiByb2xlTmFtZSxcbiAgICAgICAgYXNzdW1lZEJ5OiBuZXcgaWFtLlNlcnZpY2VQcmluY2lwYWwoJ2JlZHJvY2suYW1hem9uYXdzLmNvbScpLFxuICAgICAgfSk7XG4gICAgICB0aGlzLnJvbGUuYXNzdW1lUm9sZVBvbGljeSEuYWRkU3RhdGVtZW50cyhcbiAgICAgICAgbmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICAgIGFjdGlvbnM6IFsnc3RzOkFzc3VtZVJvbGUnXSxcbiAgICAgICAgICBwcmluY2lwYWxzOiBbbmV3IGlhbS5TZXJ2aWNlUHJpbmNpcGFsKCdiZWRyb2NrLmFtYXpvbmF3cy5jb20nKV0sXG4gICAgICAgICAgY29uZGl0aW9uczoge1xuICAgICAgICAgICAgU3RyaW5nRXF1YWxzOiB7XG4gICAgICAgICAgICAgICdhd3M6U291cmNlQWNjb3VudCc6IGNkay5TdGFjay5vZih0aGlzKS5hY2NvdW50LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIEFybkxpa2U6IHtcbiAgICAgICAgICAgICAgJ2F3czpTb3VyY2VBcm4nOiBjZGsuU3RhY2sub2YodGhpcykuZm9ybWF0QXJuKHtcbiAgICAgICAgICAgICAgICBzZXJ2aWNlOiAnYmVkcm9jaycsXG4gICAgICAgICAgICAgICAgcmVzb3VyY2U6ICdrbm93bGVkZ2UtYmFzZScsXG4gICAgICAgICAgICAgICAgcmVzb3VyY2VOYW1lOiAnKicsXG4gICAgICAgICAgICAgICAgYXJuRm9ybWF0OiBjZGsuQXJuRm9ybWF0LlNMQVNIX1JFU09VUkNFX05BTUUsXG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KSxcbiAgICAgICk7XG5cbiAgICAgIHRoaXMucm9sZS5hZGRUb1BvbGljeShcbiAgICAgICAgbmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICAgIGFjdGlvbnM6IFsnYmVkcm9jazpJbnZva2VNb2RlbCddLFxuICAgICAgICAgIHJlc291cmNlczogW2VtYmVkZGluZ3NNb2RlbC5hc0Fybih0aGlzKV0sXG4gICAgICAgIH0pLFxuICAgICAgKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIHRoZSB2ZWN0b3Igc3RvcmUgaWYgdGhlIHZlY3RvciBzdG9yZSB3YXMgcHJvdmlkZWQgYnkgdGhlIHVzZXIuXG4gICAgICogT3RoZXJ3aXNlIGNoZWNrIGFnYWludHMgYWxsIHBvc3NpYmxlIHZlY3RvciBkYXRhc3RvcmVzLlxuICAgICAqIElmIG5vbmUgd2FzIHByb3ZpZGVkIGNyZWF0ZSBkZWZhdWx0IE9wZW5TZWFyY2ggU2VydmVybGVzcyBDb2xsZWN0aW9uLlxuICAgICAqL1xuICAgIGlmIChwcm9wcy52ZWN0b3JTdG9yZSBpbnN0YW5jZW9mIFZlY3RvckNvbGxlY3Rpb24pIHtcbiAgICAgICh7XG4gICAgICAgIHZlY3RvclN0b3JlOiB0aGlzLnZlY3RvclN0b3JlLFxuICAgICAgICB2ZWN0b3JTdG9yZVR5cGU6IHRoaXMudmVjdG9yU3RvcmVUeXBlLFxuICAgICAgfSA9IHRoaXMuaGFuZGxlT3BlblNlYXJjaENvbGxlY3Rpb24ocHJvcHMpKTtcbiAgICB9IGVsc2UgaWYgKHByb3BzLnZlY3RvclN0b3JlIGluc3RhbmNlb2YgUGluZWNvbmVWZWN0b3JTdG9yZSkge1xuICAgICAgKHtcbiAgICAgICAgdmVjdG9yU3RvcmU6IHRoaXMudmVjdG9yU3RvcmUsXG4gICAgICAgIHZlY3RvclN0b3JlVHlwZTogdGhpcy52ZWN0b3JTdG9yZVR5cGUsXG4gICAgICB9ID0gdGhpcy5oYW5kbGVQaW5lY29uZVZlY3RvclN0b3JlKHByb3BzKSk7XG4gICAgfSBlbHNlIGlmIChwcm9wcy52ZWN0b3JTdG9yZSBpbnN0YW5jZW9mIEFtYXpvbkF1cm9yYVZlY3RvclN0b3JlKSB7XG4gICAgICAoe1xuICAgICAgICB2ZWN0b3JTdG9yZTogdGhpcy52ZWN0b3JTdG9yZSxcbiAgICAgICAgdmVjdG9yU3RvcmVUeXBlOiB0aGlzLnZlY3RvclN0b3JlVHlwZSxcbiAgICAgIH0gPSB0aGlzLmhhbmRsZUFtYXpvbkF1cm9yYVZlY3RvclN0b3JlKHByb3BzKSk7XG4gICAgfSBlbHNlIGlmIChwcm9wcy52ZWN0b3JTdG9yZSBpbnN0YW5jZW9mIEFtYXpvbkF1cm9yYURlZmF1bHRWZWN0b3JTdG9yZSkge1xuICAgICAgKHtcbiAgICAgICAgdmVjdG9yU3RvcmU6IHRoaXMudmVjdG9yU3RvcmUsXG4gICAgICAgIHZlY3RvclN0b3JlVHlwZTogdGhpcy52ZWN0b3JTdG9yZVR5cGUsXG4gICAgICB9ID0gdGhpcy5oYW5kbGVBbWF6b25BdXJvcmFEZWZhdWx0VmVjdG9yU3RvcmUocHJvcHMpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgKHtcbiAgICAgICAgdmVjdG9yU3RvcmU6IHRoaXMudmVjdG9yU3RvcmUsXG4gICAgICAgIHZlY3RvclN0b3JlVHlwZTogdGhpcy52ZWN0b3JTdG9yZVR5cGUsXG4gICAgICB9ID0gdGhpcy5oYW5kbGVPcGVuU2VhcmNoRGVmYXVsdFZlY3RvckNvbGxlY3Rpb24oKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogV2UgbmVlZCB0byBhZGQgYHNlY3JldHNtYW5hZ2VyOkdldFNlY3JldFZhbHVlYCB0byB0aGUgcm9sZVxuICAgICAqIG9mIHRoZSBrbm93bGVkZ2UgYmFzZSBpZiB3ZSB1c2UgZGF0YSBzb3VyY2VzXG4gICAgICogb3RoZXIgdGhhbiBPcGVuU2VhcmNoIFNlcnZlcmxlc3MuXG4gICAgICovXG4gICAgaWYgKCEodGhpcy52ZWN0b3JTdG9yZSBpbnN0YW5jZW9mIFZlY3RvckNvbGxlY3Rpb24pKSB7XG4gICAgICB0aGlzLnJvbGUuYWRkVG9Qb2xpY3koXG4gICAgICAgIG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgICBhY3Rpb25zOiBbJ3NlY3JldHNtYW5hZ2VyOkdldFNlY3JldFZhbHVlJ10sXG4gICAgICAgICAgcmVzb3VyY2VzOiBbdGhpcy52ZWN0b3JTdG9yZS5jcmVkZW50aWFsc1NlY3JldEFybl0sXG4gICAgICAgIH0pLFxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBXZSBuZWVkIHRvIGFkZCBgcmRzLWRhdGE6RXhlY3V0ZVN0YXRlbWVudGAsXG4gICAgICogYHJkcy1kYXRhOkJhdGNoRXhlY3V0ZVN0YXRlbWVudGAgYW5kXG4gICAgICogYHJkczpEZXNjcmliZURCQ2x1c3RlcnNgIHRvIHRoZSByb2xlXG4gICAgICogb2YgdGhlIGtub3dsZWRnZSBiYXNlIGlmIHdlIHVzZSBBbWF6b24gQXVyb3JhIGFzXG4gICAgICogYSBkYXRhIHNvdXJjZS5cbiAgICAgKi9cbiAgICBpZiAoXG4gICAgICB0aGlzLnZlY3RvclN0b3JlIGluc3RhbmNlb2YgQW1hem9uQXVyb3JhRGVmYXVsdFZlY3RvclN0b3JlIHx8XG4gICAgICB0aGlzLnZlY3RvclN0b3JlIGluc3RhbmNlb2YgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmVcbiAgICApIHtcbiAgICAgIHRoaXMucm9sZS5hZGRUb1BvbGljeShcbiAgICAgICAgbmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICAgIGFjdGlvbnM6IFtcbiAgICAgICAgICAgICdyZHMtZGF0YTpFeGVjdXRlU3RhdGVtZW50JyxcbiAgICAgICAgICAgICdyZHMtZGF0YTpCYXRjaEV4ZWN1dGVTdGF0ZW1lbnQnLFxuICAgICAgICAgICAgJ3JkczpEZXNjcmliZURCQ2x1c3RlcnMnLFxuICAgICAgICAgIF0sXG4gICAgICAgICAgcmVzb3VyY2VzOiBbdGhpcy52ZWN0b3JTdG9yZS5yZXNvdXJjZUFybl0sXG4gICAgICAgIH0pLFxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgdGhlIHZlY3RvciBpbmRleCBpZiB0aGUgdmVjdG9yIHN0b3JlIGlzIE9wZW5TZWFyY2ggU2VydmVybGVzc1xuICAgICAqIGFuZCBpdCB3YXMgbm90IHByb3ZpZGVkLiBPdGhlcndpc2UgdXNlIHRoZSBwcm92aWRlZCB2ZWN0b3IgaW5kZXguXG4gICAgICovXG4gICAgaWYgKHRoaXMudmVjdG9yU3RvcmVUeXBlID09PSBWZWN0b3JTdG9yZVR5cGUuT1BFTlNFQVJDSF9TRVJWRVJMRVNTKSB7XG4gICAgICBpZiAoIXByb3BzLnZlY3RvckluZGV4KSB7XG4gICAgICAgIHRoaXMudmVjdG9ySW5kZXggPSBuZXcgVmVjdG9ySW5kZXgodGhpcywgJ0tCSW5kZXgnLCB7XG4gICAgICAgICAgY29sbGVjdGlvbjogdGhpcy52ZWN0b3JTdG9yZSBhcyBWZWN0b3JDb2xsZWN0aW9uLFxuICAgICAgICAgIGluZGV4TmFtZSxcbiAgICAgICAgICB2ZWN0b3JGaWVsZCxcbiAgICAgICAgICB2ZWN0b3JEaW1lbnNpb25zOiBlbWJlZGRpbmdzTW9kZWwudmVjdG9yRGltZW5zaW9ucyEsXG4gICAgICAgICAgbWFwcGluZ3M6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgbWFwcGluZ0ZpZWxkOiAnQU1BWk9OX0JFRFJPQ0tfVEVYVF9DSFVOSycsXG4gICAgICAgICAgICAgIGRhdGFUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICAgIGZpbHRlcmFibGU6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBtYXBwaW5nRmllbGQ6ICdBTUFaT05fQkVEUk9DS19NRVRBREFUQScsXG4gICAgICAgICAgICAgIGRhdGFUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICAgIGZpbHRlcmFibGU6IGZhbHNlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdLFxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnZlY3RvckluZGV4Lm5vZGUuYWRkRGVwZW5kZW5jeSh0aGlzLnZlY3RvclN0b3JlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMudmVjdG9ySW5kZXggPSBwcm9wcy52ZWN0b3JJbmRleDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgc3RvcmFnZSBjb25maWd1cmFpb24uIElmIGl0IGlzIG9mIHR5cGUgb2ZcbiAgICAgKiBgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmVgIGdldCB0ZXh0RmllbGQsIG1ldGFkYXRhRmllbGQsXG4gICAgICogdmVjdG9yRmllbGQgZnJvbSB0aGUgYXJndW1lbnRzLiBPdGhlcndpc2UgdXNlIGRlZmF1bHQgdmFsdWVzLlxuICAgICAqL1xuICAgIGNvbnN0IHN0b3JhZ2VDb25maWd1cmF0aW9uOiBTdG9yYWdlQ29uZmlndXJhdGlvbiA9IHtcbiAgICAgIGluZGV4TmFtZTogaW5kZXhOYW1lLFxuICAgICAgdmVjdG9yU3RvcmU6IHRoaXMudmVjdG9yU3RvcmUsXG4gICAgICB2ZWN0b3JTdG9yZVR5cGU6IHRoaXMudmVjdG9yU3RvcmVUeXBlLFxuICAgICAgdmVjdG9yRmllbGQ6XG4gICAgICAgIHRoaXMudmVjdG9yU3RvcmUgaW5zdGFuY2VvZiBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZVxuICAgICAgICAgID8gdGhpcy52ZWN0b3JTdG9yZS52ZWN0b3JGaWVsZFxuICAgICAgICAgIDogdmVjdG9yRmllbGQsXG4gICAgICB0ZXh0RmllbGQ6XG4gICAgICAgIHRoaXMudmVjdG9yU3RvcmUgaW5zdGFuY2VvZiBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZSB8fFxuICAgICAgICB0aGlzLnZlY3RvclN0b3JlIGluc3RhbmNlb2YgUGluZWNvbmVWZWN0b3JTdG9yZVxuICAgICAgICAgID8gdGhpcy52ZWN0b3JTdG9yZS50ZXh0RmllbGRcbiAgICAgICAgICA6IHRleHRGaWVsZCxcbiAgICAgIG1ldGFkYXRhRmllbGQ6XG4gICAgICAgIHRoaXMudmVjdG9yU3RvcmUgaW5zdGFuY2VvZiBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZSB8fFxuICAgICAgICB0aGlzLnZlY3RvclN0b3JlIGluc3RhbmNlb2YgUGluZWNvbmVWZWN0b3JTdG9yZVxuICAgICAgICAgID8gdGhpcy52ZWN0b3JTdG9yZS5tZXRhZGF0YUZpZWxkXG4gICAgICAgICAgOiBtZXRhZGF0YUZpZWxkLFxuICAgIH07XG5cbiAgICBjb25zdCBrbm93bGVkZ2VCYXNlID0gbmV3IGJlZHJvY2suQ2ZuS25vd2xlZGdlQmFzZShcbiAgICAgIHRoaXMsXG4gICAgICAnTXlDZm5Lbm93bGVkZ2VCYXNlJyxcbiAgICAgIHtcbiAgICAgICAga25vd2xlZGdlQmFzZUNvbmZpZ3VyYXRpb246IHtcbiAgICAgICAgICB0eXBlOiAnVkVDVE9SJyxcbiAgICAgICAgICB2ZWN0b3JLbm93bGVkZ2VCYXNlQ29uZmlndXJhdGlvbjoge1xuICAgICAgICAgICAgZW1iZWRkaW5nTW9kZWxBcm46IGVtYmVkZGluZ3NNb2RlbC5hc0Fybih0aGlzKSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBuYW1lOiB0aGlzLm5hbWUsXG4gICAgICAgIHJvbGVBcm46IHRoaXMucm9sZS5yb2xlQXJuLFxuICAgICAgICBzdG9yYWdlQ29uZmlndXJhdGlvbjogZ2V0U3RvcmFnZUNvbmZpZ3VyYXRpb24oc3RvcmFnZUNvbmZpZ3VyYXRpb24pLFxuICAgICAgICBkZXNjcmlwdGlvbjogcHJvcHMuZGVzY3JpcHRpb24sXG4gICAgICAgIHRhZ3M6IHByb3BzLnRhZ3MsXG4gICAgICB9LFxuICAgICk7XG5cbiAgICB0aGlzLmtub3dsZWRnZUJhc2VJbnN0YW5jZSA9IGtub3dsZWRnZUJhc2U7XG5cbiAgICBjb25zdCBrYkNSUG9saWN5ID0gbmV3IGlhbS5Qb2xpY3kodGhpcywgJ0tCQ1JQb2xpY3knLCB7XG4gICAgICAvLyByb2xlczogW2NyUHJvdmlkZXIucm9sZV0sXG4gICAgICByb2xlczogW3RoaXMucm9sZV0sXG4gICAgICBzdGF0ZW1lbnRzOiBbXG4gICAgICAgIG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgICBhY3Rpb25zOiBbXG4gICAgICAgICAgICAnYmVkcm9jazpDcmVhdGVLbm93bGVkZ2VCYXNlJyxcbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogV2UgbmVlZCB0byBhZGQgYGJlZHJvY2s6QXNzb2NpYXRlVGhpcmRQYXJ0eUtub3dsZWRnZUJhc2VgIGlmXG4gICAgICAgICAgICAgKiB3ZSBhcmUgZGVwbG95aW5nIFJlZGlzIG9yIFBpbmVjb25lIGRhdGEgc291cmNlc1xuICAgICAgICAgICAgICovXG4gICAgICAgICAgICAvLy4uLih0aGlzLnZlY3RvclN0b3JlVHlwZSA9PT0gVmVjdG9yU3RvcmVUeXBlLlJFRElTX0VOVEVSUFJJU0VfQ0xPVUQgfHxcbiAgICAgICAgICAgIC4uLih0aGlzLnZlY3RvclN0b3JlVHlwZSA9PT0gVmVjdG9yU3RvcmVUeXBlLlBJTkVDT05FXG4gICAgICAgICAgICAgID8gWydiZWRyb2NrOkFzc29jaWF0ZVRoaXJkUGFydHlLbm93bGVkZ2VCYXNlJ11cbiAgICAgICAgICAgICAgOiBbXSksXG4gICAgICAgICAgXSxcbiAgICAgICAgICByZXNvdXJjZXM6IFsnKiddLFxuICAgICAgICB9KSxcbiAgICAgICAgbmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICAgIGFjdGlvbnM6IFtcbiAgICAgICAgICAgICdiZWRyb2NrOlVwZGF0ZUtub3dsZWRnZUJhc2UnLFxuICAgICAgICAgICAgJ2JlZHJvY2s6RGVsZXRlS25vd2xlZGdlQmFzZScsXG4gICAgICAgICAgICAnYmVkcm9jazpUYWdSZXNvdXJjZScsXG4gICAgICAgICAgXSxcbiAgICAgICAgICByZXNvdXJjZXM6IFtcbiAgICAgICAgICAgIGNkay5TdGFjay5vZih0aGlzKS5mb3JtYXRBcm4oe1xuICAgICAgICAgICAgICBzZXJ2aWNlOiAnYmVkcm9jaycsXG4gICAgICAgICAgICAgIHJlc291cmNlOiAna25vd2xlZGdlLWJhc2UnLFxuICAgICAgICAgICAgICByZXNvdXJjZU5hbWU6ICcqJyxcbiAgICAgICAgICAgICAgYXJuRm9ybWF0OiBjZGsuQXJuRm9ybWF0LlNMQVNIX1JFU09VUkNFX05BTUUsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICBdLFxuICAgICAgICB9KSxcbiAgICAgICAgbmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICAgIGFjdGlvbnM6IFsnaWFtOlBhc3NSb2xlJ10sXG4gICAgICAgICAgcmVzb3VyY2VzOiBbdGhpcy5yb2xlLnJvbGVBcm5dLFxuICAgICAgICB9KSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBrbm93bGVkZ2VCYXNlLm5vZGUuYWRkRGVwZW5kZW5jeSh0aGlzLnJvbGUpO1xuICAgIGtub3dsZWRnZUJhc2Uubm9kZS5hZGREZXBlbmRlbmN5KGtiQ1JQb2xpY3kpO1xuICAgIGlmIChcbiAgICAgIHRoaXMudmVjdG9yU3RvcmVUeXBlID09PSBWZWN0b3JTdG9yZVR5cGUuT1BFTlNFQVJDSF9TRVJWRVJMRVNTICYmXG4gICAgICB0aGlzLnZlY3RvckluZGV4XG4gICAgKSB7XG4gICAgICBrbm93bGVkZ2VCYXNlLm5vZGUuYWRkRGVwZW5kZW5jeSh0aGlzLnZlY3RvckluZGV4KTtcbiAgICB9XG4gICAgaWYgKFxuICAgICAgdGhpcy52ZWN0b3JTdG9yZVR5cGUgPT09IFZlY3RvclN0b3JlVHlwZS5BTUFaT05fQVVST1JBICYmXG4gICAgICB0aGlzLnZlY3RvclN0b3JlIGluc3RhbmNlb2YgQW1hem9uQXVyb3JhRGVmYXVsdFZlY3RvclN0b3JlXG4gICAgKSB7XG4gICAgICBrbm93bGVkZ2VCYXNlLm5vZGUuYWRkRGVwZW5kZW5jeSh0aGlzLnZlY3RvclN0b3JlKTtcbiAgICB9XG5cbiAgICBOYWdTdXBwcmVzc2lvbnMuYWRkUmVzb3VyY2VTdXBwcmVzc2lvbnMoXG4gICAgICBrYkNSUG9saWN5LFxuICAgICAgW1xuICAgICAgICB7XG4gICAgICAgICAgaWQ6ICdBd3NTb2x1dGlvbnMtSUFNNScsXG4gICAgICAgICAgcmVhc29uOlxuICAgICAgICAgICAgXCJCZWRyb2NrIENyZWF0ZUtub3dsZWRnZUJhc2UgY2FuJ3QgYmUgcmVzdHJpY3RlZCBieSByZXNvdXJjZS5cIixcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICB0cnVlLFxuICAgICk7XG5cbiAgICB0aGlzLmtub3dsZWRnZUJhc2VBcm4gPSBrbm93bGVkZ2VCYXNlLmF0dHJLbm93bGVkZ2VCYXNlQXJuO1xuICAgIHRoaXMua25vd2xlZGdlQmFzZUlkID0ga25vd2xlZGdlQmFzZS5hdHRyS25vd2xlZGdlQmFzZUlkO1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBWZWN0b3JDb2xsZWN0aW9uIHR5cGUgb2YgVmVjdG9yU3RvcmUuXG4gICAqXG4gICAqIEBwYXJhbSBwcm9wcyAtIFRoZSBwcm9wZXJ0aWVzIG9mIHRoZSBLbm93bGVkZ2VCYXNlLlxuICAgKiBAcmV0dXJucyBUaGUgaW5zdGFuY2Ugb2YgVmVjdG9yQ29sbGVjdGlvbiwgVmVjdG9yU3RvcmVUeXBlLlxuICAgKiBAaW50ZXJuYWwgVGhpcyBpcyBhbiBpbnRlcm5hbCBjb3JlIGZ1bmN0aW9uIGFuZCBzaG91bGQgbm90IGJlIGNhbGxlZCBkaXJlY3RseS5cbiAgICovXG4gIHByaXZhdGUgaGFuZGxlT3BlblNlYXJjaENvbGxlY3Rpb24ocHJvcHM6IEtub3dsZWRnZUJhc2VQcm9wcyk6IHtcbiAgICB2ZWN0b3JTdG9yZTogVmVjdG9yQ29sbGVjdGlvbjtcbiAgICB2ZWN0b3JTdG9yZVR5cGU6IFZlY3RvclN0b3JlVHlwZTtcbiAgfSB7XG4gICAgY29uc3QgdmVjdG9yU3RvcmUgPSBwcm9wcy52ZWN0b3JTdG9yZSBhcyBWZWN0b3JDb2xsZWN0aW9uO1xuICAgIHZlY3RvclN0b3JlLmdyYW50RGF0YUFjY2Vzcyh0aGlzLnJvbGUpO1xuICAgIHJldHVybiB7XG4gICAgICB2ZWN0b3JTdG9yZTogdmVjdG9yU3RvcmUsXG4gICAgICB2ZWN0b3JTdG9yZVR5cGU6IFZlY3RvclN0b3JlVHlwZS5PUEVOU0VBUkNIX1NFUlZFUkxFU1MsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGUgUGluZWNvbmVWZWN0b3JTdG9yZSB0eXBlIG9mIFZlY3RvclN0b3JlLlxuICAgKlxuICAgKiBAcGFyYW0gcHJvcHMgLSBUaGUgcHJvcGVydGllcyBvZiB0aGUgS25vd2xlZGdlQmFzZS5cbiAgICogQHJldHVybnMgVGhlIGluc3RhbmNlIG9mIFBpbmVjb25lVmVjdG9yU3RvcmUsIFZlY3RvclN0b3JlVHlwZS5cbiAgICogQGludGVybmFsIFRoaXMgaXMgYW4gaW50ZXJuYWwgY29yZSBmdW5jdGlvbiBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHkuXG4gICAqL1xuICBwcml2YXRlIGhhbmRsZVBpbmVjb25lVmVjdG9yU3RvcmUocHJvcHM6IEtub3dsZWRnZUJhc2VQcm9wcyk6IHtcbiAgICB2ZWN0b3JTdG9yZTogUGluZWNvbmVWZWN0b3JTdG9yZTtcbiAgICB2ZWN0b3JTdG9yZVR5cGU6IFZlY3RvclN0b3JlVHlwZTtcbiAgfSB7XG4gICAgY29uc3QgdmVjdG9yU3RvcmUgPSBwcm9wcy52ZWN0b3JTdG9yZSBhcyBQaW5lY29uZVZlY3RvclN0b3JlO1xuICAgIHJldHVybiB7XG4gICAgICB2ZWN0b3JTdG9yZTogdmVjdG9yU3RvcmUsXG4gICAgICB2ZWN0b3JTdG9yZVR5cGU6IFZlY3RvclN0b3JlVHlwZS5QSU5FQ09ORSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZSB0eXBlIG9mIFZlY3RvclN0b3JlLlxuICAgKlxuICAgKiBAcGFyYW0gcHJvcHMgLSBUaGUgcHJvcGVydGllcyBvZiB0aGUgS25vd2xlZGdlQmFzZS5cbiAgICogQHJldHVybnMgVGhlIGluc3RhbmNlIG9mIEFtYXpvbkF1cm9yYVZlY3RvclN0b3JlLCBWZWN0b3JTdG9yZVR5cGUuXG4gICAqIEBpbnRlcm5hbCBUaGlzIGlzIGFuIGludGVybmFsIGNvcmUgZnVuY3Rpb24gYW5kIHNob3VsZCBub3QgYmUgY2FsbGVkIGRpcmVjdGx5LlxuICAgKi9cbiAgcHJpdmF0ZSBoYW5kbGVBbWF6b25BdXJvcmFWZWN0b3JTdG9yZShwcm9wczogS25vd2xlZGdlQmFzZVByb3BzKToge1xuICAgIHZlY3RvclN0b3JlOiBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZTtcbiAgICB2ZWN0b3JTdG9yZVR5cGU6IFZlY3RvclN0b3JlVHlwZTtcbiAgfSB7XG4gICAgY29uc3QgdmVjdG9yU3RvcmUgPSBwcm9wcy52ZWN0b3JTdG9yZSBhcyBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZTtcbiAgICByZXR1cm4ge1xuICAgICAgdmVjdG9yU3RvcmU6IHZlY3RvclN0b3JlLFxuICAgICAgdmVjdG9yU3RvcmVUeXBlOiBWZWN0b3JTdG9yZVR5cGUuQU1BWk9OX0FVUk9SQSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBBbWF6b25BdXJvcmFEZWZhdWx0VmVjdG9yU3RvcmUgdHlwZSBvZiBWZWN0b3JTdG9yZS5cbiAgICpcbiAgICogQHBhcmFtIHByb3BzIC0gVGhlIHByb3BlcnRpZXMgb2YgdGhlIEtub3dsZWRnZUJhc2UuXG4gICAqIEByZXR1cm5zIFRoZSBpbnN0YW5jZSBvZiBBbWF6b25BdXJvcmFEZWZhdWx0VmVjdG9yU3RvcmUsIFZlY3RvclN0b3JlVHlwZS5cbiAgICogQGludGVybmFsIFRoaXMgaXMgYW4gaW50ZXJuYWwgY29yZSBmdW5jdGlvbiBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHkuXG4gICAqL1xuICBwcml2YXRlIGhhbmRsZUFtYXpvbkF1cm9yYURlZmF1bHRWZWN0b3JTdG9yZShwcm9wczogS25vd2xlZGdlQmFzZVByb3BzKToge1xuICAgIHZlY3RvclN0b3JlOiBBbWF6b25BdXJvcmFEZWZhdWx0VmVjdG9yU3RvcmU7XG4gICAgdmVjdG9yU3RvcmVUeXBlOiBWZWN0b3JTdG9yZVR5cGU7XG4gIH0ge1xuICAgIGNvbnN0IHZlY3RvclN0b3JlID0gcHJvcHMudmVjdG9yU3RvcmUgYXMgQW1hem9uQXVyb3JhRGVmYXVsdFZlY3RvclN0b3JlO1xuICAgIHJldHVybiB7XG4gICAgICB2ZWN0b3JTdG9yZTogdmVjdG9yU3RvcmUsXG4gICAgICB2ZWN0b3JTdG9yZVR5cGU6IFZlY3RvclN0b3JlVHlwZS5BTUFaT05fQVVST1JBLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlIHRoZSBkZWZhdWx0IFZlY3RvclN0b3JlIHR5cGUuXG4gICAqXG4gICAqIEByZXR1cm5zIFRoZSBpbnN0YW5jZSBvZiBWZWN0b3JDb2xsZWN0aW9uLCBWZWN0b3JTdG9yZVR5cGUuXG4gICAqIEBpbnRlcm5hbCBUaGlzIGlzIGFuIGludGVybmFsIGNvcmUgZnVuY3Rpb24gYW5kIHNob3VsZCBub3QgYmUgY2FsbGVkIGRpcmVjdGx5LlxuICAgKi9cbiAgcHJpdmF0ZSBoYW5kbGVPcGVuU2VhcmNoRGVmYXVsdFZlY3RvckNvbGxlY3Rpb24oKToge1xuICAgIHZlY3RvclN0b3JlOiBWZWN0b3JDb2xsZWN0aW9uO1xuICAgIHZlY3RvclN0b3JlVHlwZTogVmVjdG9yU3RvcmVUeXBlO1xuICB9IHtcbiAgICBjb25zdCB2ZWN0b3JTdG9yZSA9IG5ldyBWZWN0b3JDb2xsZWN0aW9uKHRoaXMsICdLQlZlY3RvcnMnKTtcbiAgICB2ZWN0b3JTdG9yZS5ncmFudERhdGFBY2Nlc3ModGhpcy5yb2xlKTtcbiAgICByZXR1cm4ge1xuICAgICAgdmVjdG9yU3RvcmU6IHZlY3RvclN0b3JlLFxuICAgICAgdmVjdG9yU3RvcmVUeXBlOiBWZWN0b3JTdG9yZVR5cGUuT1BFTlNFQVJDSF9TRVJWRVJMRVNTLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQXNzb2NpYXRlIGtub3dsZWRnZSBiYXNlIHdpdGggYW4gYWdlbnRcbiAgICovXG4gIHB1YmxpYyBhc3NvY2lhdGVUb0FnZW50KGFnZW50OiBBZ2VudCkge1xuICAgIGNvbnN0IGFnZW50S25vd2xlZGdlQmFzZVByb3BlcnR5OiBiZWRyb2NrLkNmbkFnZW50LkFnZW50S25vd2xlZGdlQmFzZVByb3BlcnR5ID1cbiAgICAgIHtcbiAgICAgICAgZGVzY3JpcHRpb246IHRoaXMuZGVzY3JpcHRpb24sXG4gICAgICAgIGtub3dsZWRnZUJhc2VJZDogdGhpcy5rbm93bGVkZ2VCYXNlSWQsXG4gICAgICAgIGtub3dsZWRnZUJhc2VTdGF0ZTogdGhpcy5rbm93bGVkZ2VCYXNlU3RhdGUsXG4gICAgICB9O1xuICAgIGFnZW50Lmtub3dsZWRnZUJhc2VzID0gW2FnZW50S25vd2xlZGdlQmFzZVByb3BlcnR5XTtcbiAgfVxufVxuXG4vKipcbiAqIFZhbGlkYXRlIHRoYXQgQmVkcm9jayBLbm93bGVkZ2UgQmFzZSBjYW4gdXNlIHRoZSBzZWxlY3RlZCBtb2RlbC5cbiAqXG4gKiBAaW50ZXJuYWwgVGhpcyBpcyBhbiBpbnRlcm5hbCBjb3JlIGZ1bmN0aW9uIGFuZCBzaG91bGQgbm90IGJlIGNhbGxlZCBkaXJlY3RseS5cbiAqL1xuZnVuY3Rpb24gdmFsaWRhdGVNb2RlbChmb3VuZGF0aW9uTW9kZWw6IEJlZHJvY2tGb3VuZGF0aW9uTW9kZWwpIHtcbiAgaWYgKCFmb3VuZGF0aW9uTW9kZWwuc3VwcG9ydHNLbm93bGVkZ2VCYXNlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgYFRoZSBtb2RlbCAke2ZvdW5kYXRpb25Nb2RlbH0gaXMgbm90IHN1cHBvcnRlZCBieSBCZWRyb2NrIEtub3dsZWRnZSBCYXNlLmAsXG4gICAgKTtcbiAgfVxufVxuXG4vKipcbiAqIFZhbGlkYXRlIGlmIFZlY3RvckluZGV4IHdhcyBwcm92aWRlZCBmb3IgYSBWZWN0b3JTdG9yZSBvZiB0eXBlXG4gKiBvdGhlciB0aGFuIGBWZWN0b3JDb2xsZWN0aW9uYC5cbiAqXG4gKiBAaW50ZXJuYWwgVGhpcyBpcyBhbiBpbnRlcm5hbCBjb3JlIGZ1bmN0aW9uIGFuZCBzaG91bGQgbm90IGJlIGNhbGxlZCBkaXJlY3RseS5cbiAqL1xuZnVuY3Rpb24gdmFsaWRhdGVWZWN0b3JJbmRleChcbiAgdmVjdG9yU3RvcmU6IGFueSxcbiAgdmVjdG9ySW5kZXg6IGFueSxcbiAgdmVjdG9yRmllbGQ6IGFueSxcbiAgaW5kZXhOYW1lOiBhbnksXG4pIHtcbiAgaWYgKCEodmVjdG9yU3RvcmUgaW5zdGFuY2VvZiBWZWN0b3JDb2xsZWN0aW9uKSAmJiB2ZWN0b3JJbmRleCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICdJZiB2ZWN0b3JTdG9yZSBpcyBub3Qgb2YgdHlwZSBWZWN0b3JDb2xsZWN0aW9uLCB2ZWN0b3JJbmRleCBzaG91bGQgbm90IGJlIHByb3ZpZGVkICcgK1xuICAgICAgICAnaW4gS25vd2xlZGdlQmFzZSBjb25zdHJ1Y3QuJyxcbiAgICApO1xuICB9XG4gIGlmICghKHZlY3RvclN0b3JlIGluc3RhbmNlb2YgVmVjdG9yQ29sbGVjdGlvbikgJiYgaW5kZXhOYW1lKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgJ0lmIHZlY3RvclN0b3JlIGlzIG5vdCBvZiB0eXBlIFZlY3RvckNvbGxlY3Rpb24sIGluZGV4TmFtZSBzaG91bGQgbm90IGJlIHByb3ZpZGVkICcgK1xuICAgICAgICAnaW4gS25vd2xlZGdlQmFzZSBjb25zdHJ1Y3QuJyxcbiAgICApO1xuICB9XG4gIGlmICghKHZlY3RvclN0b3JlIGluc3RhbmNlb2YgVmVjdG9yQ29sbGVjdGlvbikgJiYgdmVjdG9yRmllbGQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAnSWYgdmVjdG9yU3RvcmUgaXMgbm90IG9mIHR5cGUgVmVjdG9yQ29sbGVjdGlvbiwgdmVjdG9yRmllbGQgc2hvdWxkIG5vdCBiZSBwcm92aWRlZCAnICtcbiAgICAgICAgJ2luIEtub3dsZWRnZUJhc2UgY29uc3RydWN0LicsXG4gICAgKTtcbiAgfVxufVxuXG4vKipcbiAqIFZhbGlkYXRlIHRoYXQgaW5kZXhOYW1lIGFuZCB2ZWN0b3JGaWVsZCBwYXJhbWV0ZXJzIGFyZSBpZGVudGljYWxcbiAqIGluIEtub3dsZWRnZUJhc2UgY29uc3RydWN0IGlmIFZlY3RvckluZGV4IHdhcyBjcmVhdGVkIG1hbnVhbGx5LlxuICpcbiAqIEJ5IGRlZmF1bHQgd2UgYXNzaWduIGB2ZWN0b3JJbmRleGAgdG8gYGJlZHJvY2sta25vd2xlZGdlLWJhc2UtZGVmYXVsdC1pbmRleGBcbiAqIHZhbHVlIGFuZCBpZiB1c2VyIHByb3ZpZGVzIGB2ZWN0b3JJbmRleGAgbWFudWFsbHksIHdlIG5lZWQgdG8gbWFrZSBzdXJlXG4gKiB0aGV5IGFsc28gcHJvdmlkZSBpdCBpbiBLbm93bGVkZ2VCYXNlIGNvbnN0cnVjdCBpZiB0aGUgdmFsdWUgaXMgbm90XG4gKiBgYmVkcm9jay1rbm93bGVkZ2UtYmFzZS1kZWZhdWx0LWluZGV4YC4gU2FtZSBmb3IgdmVjdG9yRmllbGQuXG4gKlxuICogQGludGVybmFsIFRoaXMgaXMgYW4gaW50ZXJuYWwgY29yZSBmdW5jdGlvbiBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHkuXG4gKi9cbmZ1bmN0aW9uIHZhbGlkYXRlSW5kZXhQYXJhbWV0ZXJzKFxuICB2ZWN0b3JJbmRleDogVmVjdG9ySW5kZXgsXG4gIGluZGV4TmFtZTogc3RyaW5nLFxuICB2ZWN0b3JGaWVsZDogc3RyaW5nLFxuKSB7XG4gIGlmICh2ZWN0b3JJbmRleC5pbmRleE5hbWUgIT09ICdiZWRyb2NrLWtub3dsZWRnZS1iYXNlLWRlZmF1bHQtaW5kZXgnKSB7XG4gICAgaWYgKHZlY3RvckluZGV4LmluZGV4TmFtZSAhPT0gaW5kZXhOYW1lKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICdEZWZhdWx0IHZhbHVlIG9mIGluZGV4TmFtZSBpcyBgYmVkcm9jay1rbm93bGVkZ2UtYmFzZS1kZWZhdWx0LWluZGV4YC4nICtcbiAgICAgICAgICAnIElmIHlvdSBjcmVhdGUgVmVjdG9ySW5kZXggbWFudWFsbHkgYW5kIGFzc2lnbiB2ZWN0b3JJbmRleCB0byB2YWx1ZSBvdGhlciB0aGFuJyArXG4gICAgICAgICAgJyBgYmVkcm9jay1rbm93bGVkZ2UtYmFzZS1kZWZhdWx0LWluZGV4YCB0aGVuIHlvdSBtdXN0IHByb3ZpZGUgdGhlIHNhbWUgdmFsdWUgaW4gS25vd2xlZGdlQmFzZSBjb25zdHJ1Y3QuJyArXG4gICAgICAgICAgJyBJZiB5b3UgY3JlYXRlZCBWZWN0b3JJbmRleCBtYW51YWxseSBhbmQgc2V0IGl0IHRvIGBiZWRyb2NrLWtub3dsZWRnZS1iYXNlLWRlZmF1bHQtaW5kZXhgJyArXG4gICAgICAgICAgJyB0aGVuIGRvIG5vdCBhc3NpZ24gaW5kZXhOYW1lIGluIEtub3dsZWRnZUJhc2UgY29uc3RydWN0LicsXG4gICAgICApO1xuICAgIH1cbiAgfVxuICBpZiAodmVjdG9ySW5kZXgudmVjdG9yRmllbGQgIT09ICdiZWRyb2NrLWtub3dsZWRnZS1iYXNlLWRlZmF1bHQtdmVjdG9yJykge1xuICAgIGlmICh2ZWN0b3JJbmRleC52ZWN0b3JGaWVsZCAhPT0gdmVjdG9yRmllbGQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgJ0RlZmF1bHQgdmFsdWUgb2YgdmVjdG9yRmllbGQgaXMgYGJlZHJvY2sta25vd2xlZGdlLWJhc2UtZGVmYXVsdC12ZWN0b3JgLicgK1xuICAgICAgICAgICcgSWYgeW91IGNyZWF0ZSBWZWN0b3JJbmRleCBtYW51YWxseSBhbmQgYXNzaWduIHZlY3RvckZpZWxkIHRvIHZhbHVlIG90aGVyIHRoYW4nICtcbiAgICAgICAgICAnIGBiZWRyb2NrLWtub3dsZWRnZS1iYXNlLWRlZmF1bHQtZmllbGRgIHRoZW4geW91IG11c3QgcHJvdmlkZSB0aGUgc2FtZSB2YWx1ZSBpbiBLbm93bGVkZ2VCYXNlIGNvbnN0cnVjdC4nICtcbiAgICAgICAgICAnIElmIHlvdSBjcmVhdGVkIFZlY3RvckluZGV4IG1hbnVhbGx5IGFuZCBzZXQgaXQgdG8gYGJlZHJvY2sta25vd2xlZGdlLWJhc2UtZGVmYXVsdC12ZWN0b3JgJyArXG4gICAgICAgICAgJyB0aGVuIGRvIG5vdCBhc3NpZ24gdmVjdG9yRmllbGQgaW4gS25vd2xlZGdlQmFzZSBjb25zdHJ1Y3QuJyxcbiAgICAgICk7XG4gICAgfVxuICB9XG59XG5cbi8qKlxuICogRGV0ZXJtaW5lIHN0b3JhZ2UgY29uZmlndXJhdGlvbiBiYXNlZCBvbiB2ZWN0b3Igc3RvcmUgdHlwZS5cbiAqXG4gKiBAaW50ZXJuYWwgVGhpcyBpcyBhbiBpbnRlcm5hbCBjb3JlIGZ1bmN0aW9uIGFuZCBzaG91bGQgbm90IGJlIGNhbGxlZCBkaXJlY3RseS5cbiAqL1xuZnVuY3Rpb24gZ2V0U3RvcmFnZUNvbmZpZ3VyYXRpb24ocGFyYW1zOiBTdG9yYWdlQ29uZmlndXJhdGlvbik6IGFueSB7XG4gIHN3aXRjaCAocGFyYW1zLnZlY3RvclN0b3JlVHlwZSkge1xuICAgIGNhc2UgVmVjdG9yU3RvcmVUeXBlLk9QRU5TRUFSQ0hfU0VSVkVSTEVTUzpcbiAgICAgIHBhcmFtcy52ZWN0b3JTdG9yZSA9IHBhcmFtcy52ZWN0b3JTdG9yZSBhcyBWZWN0b3JDb2xsZWN0aW9uO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdHlwZTogVmVjdG9yU3RvcmVUeXBlLk9QRU5TRUFSQ0hfU0VSVkVSTEVTUyxcbiAgICAgICAgb3BlbnNlYXJjaFNlcnZlcmxlc3NDb25maWd1cmF0aW9uOiB7XG4gICAgICAgICAgY29sbGVjdGlvbkFybjogcGFyYW1zLnZlY3RvclN0b3JlLmNvbGxlY3Rpb25Bcm4sXG4gICAgICAgICAgZmllbGRNYXBwaW5nOiB7XG4gICAgICAgICAgICB2ZWN0b3JGaWVsZDogcGFyYW1zLnZlY3RvckZpZWxkLFxuICAgICAgICAgICAgdGV4dEZpZWxkOiBwYXJhbXMudGV4dEZpZWxkLFxuICAgICAgICAgICAgbWV0YWRhdGFGaWVsZDogcGFyYW1zLm1ldGFkYXRhRmllbGQsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB2ZWN0b3JJbmRleE5hbWU6IHBhcmFtcy5pbmRleE5hbWUsXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIGNhc2UgVmVjdG9yU3RvcmVUeXBlLlBJTkVDT05FOlxuICAgICAgcGFyYW1zLnZlY3RvclN0b3JlID0gcGFyYW1zLnZlY3RvclN0b3JlIGFzIFBpbmVjb25lVmVjdG9yU3RvcmU7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0eXBlOiBWZWN0b3JTdG9yZVR5cGUuUElORUNPTkUsXG4gICAgICAgIHBpbmVjb25lQ29uZmlndXJhdGlvbjoge1xuICAgICAgICAgIG5hbWVzcGFjZTogcGFyYW1zLnZlY3RvclN0b3JlLm5hbWVzcGFjZSB8fCB1bmRlZmluZWQsXG4gICAgICAgICAgY29ubmVjdGlvblN0cmluZzogcGFyYW1zLnZlY3RvclN0b3JlLmNvbm5lY3Rpb25TdHJpbmcsXG4gICAgICAgICAgY3JlZGVudGlhbHNTZWNyZXRBcm46IHBhcmFtcy52ZWN0b3JTdG9yZS5jcmVkZW50aWFsc1NlY3JldEFybixcbiAgICAgICAgICBmaWVsZE1hcHBpbmc6IHtcbiAgICAgICAgICAgIHRleHRGaWVsZDogcGFyYW1zLnRleHRGaWVsZCxcbiAgICAgICAgICAgIG1ldGFkYXRhRmllbGQ6IHBhcmFtcy5tZXRhZGF0YUZpZWxkLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIGNhc2UgVmVjdG9yU3RvcmVUeXBlLkFNQVpPTl9BVVJPUkE6XG4gICAgICBwYXJhbXMudmVjdG9yU3RvcmUgPVxuICAgICAgICBwYXJhbXMudmVjdG9yU3RvcmUgaW5zdGFuY2VvZiBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZVxuICAgICAgICAgID8gKHBhcmFtcy52ZWN0b3JTdG9yZSBhcyBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZSlcbiAgICAgICAgICA6IChwYXJhbXMudmVjdG9yU3RvcmUgYXMgQW1hem9uQXVyb3JhRGVmYXVsdFZlY3RvclN0b3JlKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6IFZlY3RvclN0b3JlVHlwZS5BTUFaT05fQVVST1JBLFxuICAgICAgICByZHNDb25maWd1cmF0aW9uOiB7XG4gICAgICAgICAgY3JlZGVudGlhbHNTZWNyZXRBcm46IHBhcmFtcy52ZWN0b3JTdG9yZS5jcmVkZW50aWFsc1NlY3JldEFybixcbiAgICAgICAgICBkYXRhYmFzZU5hbWU6IHBhcmFtcy52ZWN0b3JTdG9yZS5kYXRhYmFzZU5hbWUsXG4gICAgICAgICAgcmVzb3VyY2VBcm46IHBhcmFtcy52ZWN0b3JTdG9yZS5yZXNvdXJjZUFybixcbiAgICAgICAgICB0YWJsZU5hbWU6IHBhcmFtcy52ZWN0b3JTdG9yZS50YWJsZU5hbWUsXG4gICAgICAgICAgZmllbGRNYXBwaW5nOiB7XG4gICAgICAgICAgICB2ZWN0b3JGaWVsZDogcGFyYW1zLnZlY3RvckZpZWxkLnJlcGxhY2UoLy0vZywgJ18nKSxcbiAgICAgICAgICAgIHByaW1hcnlLZXlGaWVsZDogcGFyYW1zLnZlY3RvclN0b3JlLnByaW1hcnlLZXlGaWVsZCxcbiAgICAgICAgICAgIHRleHRGaWVsZDogcGFyYW1zLnRleHRGaWVsZC50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgbWV0YWRhdGFGaWVsZDogcGFyYW1zLm1ldGFkYXRhRmllbGQudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICBkZWZhdWx0OlxuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgVW5zdXBwb3J0ZWQgdmVjdG9yIHN0b3JlIHR5cGU6ICR7cGFyYW1zLnZlY3RvclN0b3JlVHlwZX1gLFxuICAgICAgKTtcbiAgfVxufVxuIl19